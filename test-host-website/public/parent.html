<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chatbot UI iFrame Example</title>

    <link
      rel="stylesheet"
      href="./lex-web-ui-loader/css/lex-web-ui-iframe.css"
    />
  </head>
  <body>
    <div class="container-fluid">
      <h1>Lex Chatbot UI Sample Parent Page</h1>
      <p class="lead">
        Use the chatbot UI to drive your bot. This page will dynamically update
        using the associated Lex variables as the bot dialog progresses.
      </p>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">
              Send "Buy Flowers" utterance to iframe
            </div>
            <div class="panel-body">
              <div>
                <button
                  id="send-intent"
                  type="button"
                  class="btn btn-default"
                  disabled="disabled"
                >
                  Send
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">Lex Dialog State</div>
            <div class="panel-body">
              <div>
                <strong>dialogState:</strong> <span id="dialog-state"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">Lex Slots</div>
            <div class="panel-body"><div id="slots"></div></div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">Lex Intent Name</div>
            <div class="panel-body">
              <div>
                <strong>Intent Name:</strong> <span id="intent-name"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">Lex Session Attributes</div>
            <div class="panel-body">
              <div><pre id="session-attributes"></pre></div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">Lex Response Card</div>
            <div class="panel-body">
              <div><pre id="response-card"></pre></div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="panel panel-warning">
            <div class="panel-heading">NOTE</div>
            <div class="panel-body">
              <p>
                This application was created using the
                <a href="https://github.com/awslabs/aws-lex-web-ui"
                  >aws-lex-web-ui</a
                >
                project.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Load jquery -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"
    ></script>

    <script type="module">
      import ChatBotUiLoader from "../lex-web-ui-loader/js/index.js";
      var iframeLoader = new ChatBotUiLoader.IframeLoader();

      // You can override the chatbot UI config by passing a parameter
      var chatbotUiconfig = {
        ui: {
          parentOrigin: "http://localhost:3000",
          toolbarTitle: "Couchbase",
          toolbarLogo:
            "https://www.couchbase.com/wp-content/uploads/sites/3/2023/10/SDKs_Ottoman.svg",
          positiveFeedbackIntent: "Thumbs up",
          negativeFeedbackIntent: "Thumbs down",
          helpIntent: "Help",
          enableLogin: false,
          forceLogin: false,
          AllowSuperDangerousHTMLInMessage: true,
          shouldDisplayResponseCardTitle: false,
          saveHistory: false,
          minButtonContent: "",
          hideInputFieldsForButtonResponse: false,
          pushInitialTextOnRestart: false,
          directFocusToBotInput: false,
          showDialogStateIcon: false,
          backButton: false,
          messageMenu: true,
          hideButtonMessageBubble: false,
          enableLiveChat: false,
        },
        iframe: {
          iframeOrigin: "http://localhost:8080",
          shouldLoadIframeMinimized: true,
          iframeSrcPath: "/#/?lexWebUiEmbed=true",
        },
      };

      // load the iframe
      iframeLoader
        .load(chatbotUiconfig)
        .then(function () {
          iframeLoader.api.ping();
          // perform actions on the parent dependent on the chatbot loading.
          $("#send-intent").prop("disabled", false);
        })
        .catch(function (error) {
          console.error("chatbot UI failed to load", error);
        });
    </script>

    <!-- Optional: You can use this to send/receive data to/from the chatbot UI -->
    <!-- <script>
      $(document).ready(function chatbotHandler() {
        // When the chatbot ui iframe is ready to receive the
        // dynamic config it sends the 'receivelexconfig' event to the parent
        // For example, you can send dynamic config/parameters
        // (e.g. username, geolocation) to the chatbot ui from here
        $(document).one("receivelexconfig", function onReceiveLexConfig() {
          var event = new CustomEvent("loadlexconfig", {
            detail: { config: chatbotUiconfig },
          });
          document.dispatchEvent(event);
        });

        // Once the chatbot UI is ready, it sends a 'lexWebUiReady' event
        $(document).on("lexWebUiReady", function onUpdateLexState(evt) {
          // empty
        });

        // bot update event handler
        // parent page can be updated when lex state changes
        $(document).on("updatelexstate", function onUpdateLexState(evt) {
          // empty
        });
      });
    </script> -->
  </body>
</html>
